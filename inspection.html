<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Qiddiya Resort Core District</title>

<!-- Brand Font -->
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;600&display=swap" rel="stylesheet">

<style>
:root {
  --primary: #294145;
  --secondary: #5D855E;
  --accent: #86B85E;
  --light: #E6F0DE;
  --muted: #666666;
  --white: #FFFFFF;
  --bg: #F9F9F9;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: "Oswald", sans-serif;
  background:
    radial-gradient(circle at top left, var(--light), transparent 60%),
    radial-gradient(circle at bottom right, #dfeee0, transparent 55%),
    var(--bg);
  min-height: 100vh;
  padding: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Main card */
.container {
  width: 100%;
  max-width: 620px;
  background: var(--white);
  padding: 28px;
  border-radius: 18px;
  box-shadow: 0 18px 40px rgba(0,0,0,0.08);
  position: relative;
}

/* Logo top-right */
.header {
  display: flex;
  justify-content: flex-end;
  margin-bottom: 10px;
}

.header img {
  width: 110px;
}

/* Title block */
.titles {
  text-align: center;
  margin-bottom: 28px;
}

.title {
  font-size: 26px;
  font-weight: 500;
  color: var(--primary);
  letter-spacing: 0.5px;
}

.subtitle {
  font-size: 15px;
  color: var(--muted);
  font-weight: 300;
}

/* Location info pill */
.info {
  background: var(--light);
  color: var(--primary);
  padding: 10px 14px;
  border-radius: 10px;
  font-size: 14px;
  margin-bottom: 20px;
  text-align: center;
}

/* Sections */
.section {
  margin-top: 22px;
  padding: 18px;
  background: #F9F9F9;
  border-radius: 14px;
  border: 1px solid #eee;
}

.section-title {
  font-size: 15px;
  font-weight: 500;
  color: var(--primary);
  margin-bottom: 14px;
  letter-spacing: 0.3px;
}

/* Inputs */
form label {
  display: block;
  margin-bottom: 14px;
  font-size: 14px;
  color: var(--primary);
}

form input {
  width: 100%;
  padding: 14px;
  margin-top: 6px;
  border-radius: 10px;
  border: 1.5px solid #ddd;
  font-size: 14px;
  transition: all 0.25s ease;
  font-family: inherit;
}

form input:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(134,184,94,0.2);
}

/* Submit button */
button {
  margin-top: 28px;
  padding: 15px;
  width: 100%;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: var(--white);
  font-size: 16px;
  font-weight: 500;
  border: none;
  border-radius: 14px;
  cursor: pointer;
  transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.2s;
}

button:hover {
  transform: translateY(-1px);
  box-shadow: 0 10px 20px rgba(0,0,0,0.12);
}

button:disabled {
  opacity: 0.7;
  cursor: not-allowed;
  box-shadow: none;
}

/* Message */
.message {
  margin-top: 16px;
  text-align: center;
  font-size: 14px;
  font-weight: 500;
}

/* Mobile tweaks */
@media (max-width: 500px) {
  .container {
    padding: 22px;
    border-radius: 16px;
  }

  .header img {
    width: 90px;
  }

  .title {
    font-size: 22px;
  }
}
</style>
</head>
  
<body>

<div class="container">
  <!-- Logo on top right -->
  <div class="header">
    <img src="https://infinitehse.com/wp-content/uploads/2026/01/IES_logo_with_Qiddiya-removebg.png" alt="Logo Placeholder">
  </div>

  <!-- Title in the middle -->
  <div class="titles">
    <div class="title">Qiddiya Resort Core District</div>
    <div class="subtitle">Weekly Site Environmental Inspection</div>
  </div>

  <div class="info" id="locationInfo">Detecting location...</div>

  <form id="inspectionForm">
    <input type="hidden" id="point" name="point">
    <input type="hidden" id="lat" name="lat">
    <input type="hidden" id="lng" name="lng">

    <div class="section">
      <div class="section-title">Noise Levels (dB)</div>
      <label>LA<sub>eq</sub> <input type="number" step="0.1" id="LAeq" required></label>
      <label>LA<sub>90</sub> <input type="number" step="0.1" id="LA90" required></label>
      <label>LA<sub>10</sub> <input type="number" step="0.1" id="LA10" required></label>
      <label>LA<sub>max</sub> <input type="number" step="0.1" id="LAmax" required></label>
      <label>LA<sub>min</sub> <input type="number" step="0.1" id="LAmin" required></label>
    </div>

    <div class="section">
      <div class="section-title">Air Quality (µg/m³)</div>
      <label>PM<sub>10</sub> <input type="number" step="0.1" id="PM10" required></label>
      <label>PM<sub>2.5</sub> <input type="number" step="0.1" id="PM25" required></label>
    </div>

    <button type="submit" id="submitBtn">Submit</button>
    <div class="message" id="formMessage"></div>
  </form>
</div>

<script>
const points = [
  {id: "Point #1", lat: 24.57575, lng: 46.31689},
  {id: "Point #2", lat: 24.57753, lng: 46.32825},
  {id: "Point #3", lat: 24.58586, lng: 46.33322},
  {id: "Point #4", lat: 24.58583, lng: 46.33642},
  {id: "Point #5", lat: 24.59058, lng: 46.34292},
  {id: "Point #6", lat: 24.59225, lng: 46.33586},
  {id: "Point #7", lat: 24.59092, lng: 46.32689},
  {id: "Point #8", lat: 24.58947, lng: 46.32022},
  {id: "Point #9", lat: 24.58919, lng: 46.31094},
  {id: "Point #10", lat: 24.57600, lng: 46.27450}
];

// Haversine formula
function getDistance(lat1, lon1, lat2, lon2) {
  const R = 6371000;
  const φ1 = lat1 * Math.PI/180;
  const φ2 = lat2 * Math.PI/180;
  const Δφ = (lat2-lat1) * Math.PI/180;
  const Δλ = (lon2-lon1) * Math.PI/180;
  const a = Math.sin(Δφ/2)**2 + Math.cos(φ1)*Math.cos(φ2)*Math.sin(Δλ/2)**2;
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return R * c;
}

function detectPoint(lat, lng) {
  for (let p of points) {
    if (getDistance(lat, lng, p.lat, p.lng) <= 10) {
      return p;
    }
  }
  return null;
}

// Detect location
navigator.geolocation.getCurrentPosition(
  (pos) => {
    const lat = pos.coords.latitude;
    const lng = pos.coords.longitude;

    document.getElementById("lat").value = lat;
    document.getElementById("lng").value = lng;

    const detectedPoint = detectPoint(lat, lng);
    document.getElementById("point").value = detectedPoint ? detectedPoint.id : "Unknown Point";

    document.getElementById("locationInfo").innerText = detectedPoint 
      ? `${detectedPoint.id} detected at (${detectedPoint.lat}, ${detectedPoint.lng})`
      : `Unknown Point detected at (${lat.toFixed(5)}, ${lng.toFixed(5)})`;
  },
  () => {
    document.getElementById("point").value = "Unknown Point";
    document.getElementById("lat").value = 0;
    document.getElementById("lng").value = 0;
    document.getElementById("locationInfo").innerText = "Location not available.";
  }
);

// Form submission
document.getElementById("inspectionForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const submitBtn = document.getElementById("submitBtn");
  const message = document.getElementById("formMessage");

  submitBtn.disabled = true;
  submitBtn.innerText = "Sending...";

  const data = {
    point: document.getElementById("point").value,
    lat: document.getElementById("lat").value,
    lng: document.getElementById("lng").value,
    LAeq: document.getElementById("LAeq").value,
    LA90: document.getElementById("LA90").value,
    LA10: document.getElementById("LA10").value,
    LAmax: document.getElementById("LAmax").value,
    LAmin: document.getElementById("LAmin").value,
    PM10: document.getElementById("PM10").value,
    PM25: document.getElementById("PM25").value
  };

  try {
    const response = await fetch("https://script.google.com/macros/s/AKfycbw_BboAEESwnwikl7KQTM04nJLQUEv18WUHoQVv-v-COwklaf0um5Ekgz6YxZ4d48bhtw/exec", {
      method: "POST",
      body: JSON.stringify(data)
    });
    const result = await response.json();
    if (result.result === "success") {
      message.style.color = "#0E3B32";
      message.innerText = "✅ Data submitted successfully!";
      document.getElementById("inspectionForm").reset();
    } else {
      message.style.color = "red";
      message.innerText = "❌ Submission failed!";
    }
  } catch (err) {
    message.style.color = "red";
    message.innerText = "❌ Error connecting to server.";
  }

  submitBtn.disabled = false;
  submitBtn.innerText = "Submit";
});
</script>
</body>
</html>
